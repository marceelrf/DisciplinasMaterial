---
title: "Sequenciamento de Terceira Gera√ß√£o com Oxford Nanopore"
subtitle: "Princ√≠pios e Aplica√ß√µes em Bioinform√°tica"
author: "Marcel Ferreira"
date: today
format:
  revealjs:
    theme: simple
    transition: fade
    transition-speed: slow
    width: 1500
    page-layout: full
    reference-location: document
    chalkboard: true
    footer: "marcel.ferreira@unesp.br"
    pointer:
      pointerSize: 16
      color: '#ff0800'
revealjs-plugins:
  - pointer
editor: visual
lang: pt-BR
slide-number: c/t
bibliography: references.bib
engine: knitr
---

# Sobre mim

## Muito prazer..

::: columns
::: {.column width="50%"}
![Olar!](images/marshall.jpg){fig-align="center" width="420"}
:::

::: {.column width="50%" style="font-size: 80%;"}
-   Marcel;

<br>

-   F√≠sico m√©dico;

<br>

-   Me e PhD em Biotecnologia;

<br>

-   Desde 2023, p√≥s-doutorado em gen√©tica;
:::
:::

## Interesses

::: columns
::: {.column width="50%"}
![Olar!](images/marshall.jpg){fig-align="center" width="420"}
:::

::: {.column width="50%" style="font-size: 80%;"}
-   M√©todos alternativos ao uso de animais;

-   Identific√£o humana via DNA;

-   Biologia do tecido √≥sseo;

-   Biomateriais;

-   Regenera√ß√£o tecidual;

-   Ci√™ncia aberta;

<br>

::: {#red-highlight style="color: red; font-size: 140%; text-align: center; font-weight: bold;"}
Bioinform√°tica
:::
:::
:::

## Projeto

[![Diversidade: como podemos utilizar DNA para predizer o fen√≥tipo?](https://isbet.org.br/wp-content/uploads/2024/08/grupo-de-jovens-multirraciais-sorrindo-para-a-camera-conceito-de-amizade-e-diversidade_442523-605.webp){fig-align="center" width="780"}](https://isbet.org.br/diversidade-no-estagio-e-jovem-aprendiz/)

## N√£o sou da nanopore

::: {style="text-align: center;"}
<iframe src="https://giphy.com/embed/zFa3vjySsETPa" width="414" height="480" style frameBorder="0" class="giphy-embed" allowFullScreen>

</iframe>

<p><a href="https://giphy.com/gifs/zFa3vjySsETPa">via GIPHY</a></p>
:::

# Sobre voc√™s

## Sobre voc√™s

::: {style="text-align: center;"}
<iframe src="https://giphy.com/embed/5wWf7H89PisM6An8UAU" width="960" height="558" style frameBorder="0" class="giphy-embed" allowFullScreen>

</iframe>

<p><a href="https://giphy.com/gifs/editingandlayout-the-office-michael-scott-5wWf7H89PisM6An8UAU">via GIPHY</a></p>
:::

# Sobre essa disciplina

## Primeira edi√ß√£o (de muitas...üôè)

-   Desde maio estou como colaborador no programa de Gen√©tica do IBB;

<br>

-   Infelizmente n√£o ter√° pratica de bancada;

<br>

-   Vamos aprofundar sobre aspectos de bioinform√°tica das an√°lises;

<br>

-   Vamos focar em ***gen√¥mica*** e ***epigen√¥mica***;

## Desafios üöµ

-   Bancada..

-   Requisitos computacionais...

-   Tempo...

-   Programas...

## Material online

-   [Esses slides](https://marceelrf.quarto.pub/nanopore_genetica);

<br>

-   [Livro de c√≥digos](https://marceelrf-material.netlify.app/nanopore.html);

## Fruto do meu projeto

[![Workshop realizado em 2023 e 2024.](images/Slide2.PNG){fig-align="center" width="462"}](https://workshopbioinfoforense.netlify.app/)

## M√©todo do ano de 2022

[![Publicado na Nature:](methodoftheyear.png){fig-align="center" width="516"}](https://www.nature.com/articles/s41592-022-01730-w)

## Passar os atalhos

::: columns
::: {.column width="50%"}
<iframe src="https://giphy.com/embed/1n833bZxdzKzaErLe9" width="480" height="269" style frameBorder="0" class="giphy-embed" allowFullScreen>

</iframe>

<p><a href="https://giphy.com/gifs/nba-expression-derrick-white-1n833bZxdzKzaErLe9">via GIPHY</a></p>
:::

::: {.column width="50%"}
<iframe src="https://giphy.com/embed/Cas0va26zqBvTO5vY9" width="480" height="480" style frameBorder="0" class="giphy-embed" allowFullScreen>

</iframe>

<p><a href="https://giphy.com/gifs/pudgypenguins-rage-enough-ragequit-Cas0va26zqBvTO5vY9">via GIPHY</a></p>
:::
:::

## Bioinform√°tica

-   NIH: "*Bioinformatics, as related to genetics and genomics, is a scientific subdiscipline that involves using computer technology to collect, store, analyze and disseminate biological data and information, such as DNA and amino acid sequences or annotations about those sequences.*"

::: aside
NIH: National Institute of Health
:::

## Bioinform√°tica

-   NIH: "*Bioinformatics, as related to **genetics** and **genomics**, is a scientific subdiscipline that involves using computer technology to **collect**, **store**, **analyze** and **disseminate** biological data and information, such as **DNA** and **amino acid sequences** or annotations about those sequences.*"

::: aside
NIH: National Institute of Health
:::

## Bioinform√°tica

-   N√£o vamos focar nos algoritmos;

<br>

-   Mas sim nos dados produzidos e como analisa-los;

## Cronograma

::: columns
::: {.column width="50%" style="font-size: 75%;"}
-   Dia 1 - Manh√£:

    -   Apresenta√ß√£o;

    -   Sequenciamento nanopore;

    -   Instala√ß√£o dos softwares;

<br>

-   Dia 1 - Tarde:

    -   Chamada de base;

    -   Pr√°tica;

<br>
:::

::: {.column width="50%" style="font-size: 75%;"}
-   Dia 2 - Manh√£:

    -   Mapeamento de sequ√™ncias;

    -   Pr√°tica;

<br>

-   Dia 2 - Tarde:

    -   Chamada de variantes;

    -   Pr√°tica;
:::
:::

## Cronograma

::: columns
::: {.column width="50%" style="font-size: 75%;"}
-   Dia 3 - Manh√£:

    -   Variantes estruturais;

    -   Pr√°tica;

<br>

-   Dia 3 - Tarde:

    -   Determina√ß√£o de hapl√≥tipos;

    -   Pr√°tica;

<br>
:::

::: {.column width="50%" style="font-size: 75%;"}
-   Dia 4 - Manh√£:

    -   Montagem de genomas;

    -   Pr√°tica;

<br>

-   Dia 4 - Tarde:

    -   Modifica√ß√£o de bases;

    -   Pr√°tica;

        <br>

    -   Adeus üò•.
:::
:::

## Avalia√ß√£o {auto-animate="true"}

-   3 provas;
-   2 semin√°rios;
-   Estudo dirigido;

------------------------------------------------------------------------

## Avalia√ß√£o {auto-animate="true"}

-   ~~3 provas;~~
-   ~~2 semin√°rios;~~
-   ~~Estudo dirigido;~~

<br>

-   Participa√ß√£o na disciplina e fazer as atividades.

## Programas e dados

-   Baixar arquivos do Drive \[[link](https://drive.google.com/drive/folders/1mkG-atQJBop-nr5qbk25UpRNxi8YzC6c?usp=drive_link)\];

<br>

-   Instalar o IGV [@robinson2011] \[[link](https://igv.org/doc/desktop/)\];

<br>

-   Usar o script de instala√ß√£o dos programas no Linux;

# Sequenciamento via ONT

## Ordens de Grandeza do Genoma Humano

-   N√∫mero de cromossomos: 46 (23 pares);

-   Tamanho do genoma haploide: \~3,2 bilh√µes de pares de bases (3,2 Gb);

-   N√∫mero estimado de genes codificadores de prote√≠nas: \~20.000;

## 

![](humanchr.png){fig-align="center"}

## Por que sequenciar?

. . .

-   A sequ√™ncia √© a "receita" da vida

    -   Ela determina a estrutura e fun√ß√£o das mol√©culas biol√≥gicas.

-   **DNA** ‚Üí **RNA** ‚Üí **Prote√≠na**

    -   Altera√ß√µes na sequ√™ncia podem afetar a fun√ß√£o celular e causar doen√ßas.

-   Entender a sequ√™ncia = entender o funcionamento dos organismos

    -   Do gene √† caracter√≠stica observ√°vel (fen√≥tipo).

-   Permite identificar diferen√ßas gen√©ticas

    -   Entre indiv√≠duos, esp√©cies, popula√ß√µes ou c√©lulas (ex: c√¢ncer).

## Gera√ß√£o de sequenciamento

[![https://pit.edu.vn/en/post/generations-of-gene-sequencing-technology-139.htm](seqgens.png)](https://pit.edu.vn/en/post/generations-of-gene-sequencing-technology-139.htm)

## Sequenciamento: Comparativo entre Plataformas

<br>

::: {style="font-size:80%;"}
|                |                              |                         |                     |                       |                                                      |
|-----------|-----------|-----------|-----------|-----------|----------------|
| **Plataforma** | **Tipo de Leitura**          | **Tamanho de Leitura**  | **Taxa de Erro**    | **Tempo de Execu√ß√£o** | **Aplica√ß√µes Comuns**                                |
| Illumina       | Short reads                  | 150--300 pares de bases | \<1%                | 1--2 dias             | RNA-seq, exoma, WGS, genotipagem                     |
| PacBio Hifi    | Long reads (alta fidelidade) | 10--25 kb (HiFi)        | \~1%                | 1--2 dias             | Montagem gen√¥mica, hapl√≥tipos, variantes estruturais |
| Oxford Nanopre | Long/ultralong reads         | 10 kb -- \>1 Mb         | 5--10% (melhorando) | Horas a 2 dias        | Metagen√¥mica, epigen√©tica, transcript√¥mica, forense  |
:::

## Introdu√ß√£o a tecnologia de sequenciamento

[![https://www.genome.gov/geneticsglossary/DNASequencing#:\~:text=DNA%20sequencing%20refers%20to%20the,use%20to%20develop%20and%20operate.](seqmethods.png){fig-align="center"}](https://www.genome.gov/geneticsglossary/DNASequencing#:~:text=DNA%20sequencing%20refers%20to%20the,use%20to%20develop%20and%20operate.)

## Oxford nanopore technologies (ONT)

. . .

::: columns
::: {.column width="50%"}
![](equipaments.png){fig-align="left"}
:::

::: {.column width="50%"}
::: {style="font-size: 80%;"}
-   Port√°til e escal√°vel;

-   "Barato";

-   Aquisi√ß√£o de dados em tempo real;

-   Altos volumes de dados (fastq \> 50 Gb);

-   DNA\* e RNA\*;

-   Long reads (10 kb -- 100 Kb);

-   Ultra (100 Kb -- 300 Kb);

-   Recorde 4 Mb!!!!!!;

-   Acur√°cia atual de \>99%;
:::
:::
:::

## ONT - Flowcells

![Valores te√≥rico de capacidade de sequenciamento.](flowcells.png){fig-align="center"}

## ONT - Princ√≠pio

![[@wang2021]](ont_principle.png){fig-align="center"}

## ONT - Princ√≠pio

{{< video https://youtu.be/RcP85JHLmnI?si=tmBwQYEmgRZa34zA width="90%" height="80%">}}

## ONT - Nanoporos

![Lu, C., Bonini, A., Viel, J.H.¬†et al.¬†Toward single-molecule protein sequencing using nanopores.¬†Nat Biotechnol¬†43, 312--322 (2025). [@Lu2025]](napores.png)

## ONT - Tipos de leitura

[![Duplex.](duplex.webp){fig-align="center" width="900"}](https://nanoporetech.com/document/kit-14-device-and-informatics)

## ONT - Tipos de leitura

-   `Simplex`: O sequenciamento de uma √∫nica fita. A fita de DNA modelo passa pelo nanoporo e √© submetida ao basecalling. Isso √© realizado no MinKNOW.

-   `Duplex`: O sequenciamento de ambas as fitas. A fita complementar √© lida imediatamente ap√≥s a fita modelo e o basecalling consensual para ambas as fitas leva a um aumento ainda maior na precis√£o. Isso √© realizado no Dorado.

::: aside
MinKNOW √© o software que controla o sequenciamento.
:::

## ONT - Leitura da fita

::: columns
::: {.column width="50%"}
![Sutton, M.A., Burton, A.S., Zaikova, E. et al. Radiation Tolerance of Nanopore Sequencing Technology for Life Detection on Mars and Europa. Sci Rep 9, 5370 (2019). https://doi.org/10.1038/s41598-019-41488-4](leituradafita.png)
:::

::: {.column width="50%"}
::: {style="font-size: 80%"}
:::
:::
:::

## ONT - Leitura da fita

::: columns
::: {.column width="50%"}
![Sutton, M.A., Burton, A.S., Zaikova, E. et al. Radiation Tolerance of Nanopore Sequencing Technology for Life Detection on Mars and Europa. Sci Rep 9, 5370 (2019). https://doi.org/10.1038/s41598-019-41488-4](leituradafita.png)
:::

::: {.column width="50%"}
::: {style="font-size: 80%"}
-   Leitura DNA = 400 bp por segundo;

-   RNA = 70 bp por segundo;

-   6 bases simult√¢neas por poro;

-   {A,T,C,G};
:::
:::
:::

## ONT - Leitura da fita

::: columns
::: {.column width="50%"}
![Sutton, M.A., Burton, A.S., Zaikova, E. et al. Radiation Tolerance of Nanopore Sequencing Technology for Life Detection on Mars and Europa. Sci Rep 9, 5370 (2019). https://doi.org/10.1038/s41598-019-41488-4](leituradafita.png)
:::

::: {.column width="50%"}
::: {style="font-size: 80%"}
-   Leitura DNA = 400 bp por segundo;

-   RNA = 70 bp por segundo;

-   6 bases simult√¢neas por poro;

-   {A,T,C,G};

<br>

-   4x4x4x4x4x4 =?
:::
:::
:::

## ONT - Leitura da fita

::: columns
::: {.column width="50%"}
![Sutton, M.A., Burton, A.S., Zaikova, E. et al. Radiation Tolerance of Nanopore Sequencing Technology for Life Detection on Mars and Europa. Sci Rep 9, 5370 (2019). https://doi.org/10.1038/s41598-019-41488-4](leituradafita.png)
:::

::: {.column width="50%"}
::: {style="font-size: 80%"}
-   Leitura DNA = 400 bp por segundo;

-   RNA = 70 bp por segundo;

-   6 bases simult√¢neas por poro;

-   {A,T,C,G};

<br>

-   4x4x4x4x4x4 =?

<br>

-   4096 combina√ß√µes!
:::
:::
:::

## ONT - Leitura da fita

::: center
[![Modelos de poros tem dois centros de leitura.](https://a.storyblok.com/f/196663/5384x5511/5d1ab2a959/different-types-of-nanopore.png){width="488"}](https://nanoporetech.com/platform/technology/basecalling)
:::

## ONT - RNA

![](rna.png){fig-align="center" width="1300"}

## Modifica√ß√µes no DNA

. . .

![https://www.nature.com/articles/s41587-021-01108-x](ont_prinmods.png){fig-align="center" width="806"}

## Modifica√ß√µes no DNA

-   Existem cerca de 30 modifica√ß√µes de base descrita!

. . .

::: columns
::: {.column width="50%"}
{A, T, C, G, 5mC}
:::

::: {.column width="50%"}
{A, T, C, G, 5mC, 5hmC}
:::
:::

## Modifica√ß√µes no DNA

-   Existem cerca de 30 modifica√ß√µes de base descrita!

::: columns
::: {.column width="50%"}
{A, T, C, G, 5mC}

<br>

5x5x5x5x5x5 = 15625 combina√ß√µes!
:::

::: {.column width="50%"}
{A, T, C, G, 5mC, 5hmC}

<br>

6x6x6x6x6x6 = 46656 combina√ß√µes!
:::
:::

## Basecallers

![Basecalling.](images/ont_geral.png){fig-align="center" width="1200"}

## Basecallers

-   Nanoporos diferentes cont√™m "leitores" diferentes;

    -   R10.4.1 √© o modelo atual;

-   Capturam o sinal el√©trico (POD5);

-   Basecallers transformam POD5 em FASTQ;

-   Utilizam Machine Learning (RNN);

-   Este processo pode ser feito em tempo real;

::: aside
POD5 √© o formato atual, mas pode-se encontrar FAST5;
:::

## Basecallers

[![Como funcionam](https://a.storyblok.com/f/196663/809x716/e4743867e2/neural-networks.png){fig-align="center" width="565"}](https://nanoporetech.com/platform/technology/basecalling)

## Basecallers

[![Evolu√ß√£o dos modelos.](https://a.storyblok.com/f/196663/2326x960/ae453e7f75/basecallers-timeline.png){fig-align="center" width="1200"}](https://nanoporetech.com/platform/technology/basecalling)

## Basecallers

Sugest√£o de leitura:

-   *"**From squiggle to basepair: computational approaches for improving nanopore sequencing read accuracy**"* [@rang2018]\[[link](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-018-1462-9)\]

## Bancada

. . .

-   hmwDNA;

. . .

-   Alta pureza;

. . .

-   N√£o h√° necessidade de PCR;

. . .

-   N√£o h√° necessidade convers√µes por bissulfito de s√≥dio (e afins);

## Enriquecimento do sequenciamento

. . .

-   ***Target***;

. . .

-   ***CRISPR***;

. . .

-   ***Adaptive sampling***;

## Enriquecimento do sequenciamento

[![Estrat√©gias de enriquecimento de ONT](images/enrichment3.png){fig-align="center" width="1200"}](https://www.sciencedirect.com/science/article/pii/S1872497324001522)

## Potencial

## Potencial - montagem de genomas

![https://www.phgfoundation.org/briefing/clinical-long-read-sequencing](montagemdegenomas.png){fig-align="center" width="1000"}

## Potencial - montagem de genomas

[![Montagem completa do genoma humano.](completehumangenome.png){fig-align="center" width="596"}](https://www.science.org/doi/10.1126/science.abj6987)

::: aside
[@nurk2022]
:::

## Potencial - montagem de genomas

[![Aumento de bases no genoma.](completehumangenome_2.png){fig-align="center" width="393"}](https://www.science.org/cms/10.1126/science.abj6987/asset/ec796ff1-289e-43cf-a065-ec6573199a8d/assets/images/large/science.abj6987-f1.jpg)

## Potencial - hapl√≥tipos longos

![Determinar hapl√≥tipos longos](longhap.png){fig-align="center" width="1200"}

## Potencial - hapl√≥tipos longos

[![Hapl√≥tipos do pai e da m√£e.](pecat.webp){fig-align="center" width="797"}](https://www.nature.com/articles/s41467-024-47349-7/figures/4)

## Potencial - metila√ß√£o

![Metila√ß√£o ao longo do gene MYEF2.](hapmet.png){fig-align="center" width="500"}

## Potencial - outros

-   STR [@luo2024];

<br>

-   Elementos transpon√≠veis [@smits2022];

<br>

-   Epitranscript√¥mica [@Workman2019; @Begik2022; @Jain2022];

## Estado atual

[![Sequenciamento de DNA](https://a.storyblok.com/f/196663/10800x3600/86aa012b7e/20250613_dna_q-1.png){fig-align="center" width="1200"}](https://nanoporetech.com/platform/accuracy)

$$
P = 10^{\frac{-Q}{10}}
$$

## Estado atual

[![Metila√ß√£o.](https://a.storyblok.com/f/196663/1158x952/4cc71d5637/base-modification-section-graph_mod.jpg){fig-align="center" width="608"}](https://nanoporetech.com/platform/accuracy)

## EPI2ME

::: columns
::: {.column width="50%"}
-   [EPI2ME](https://epi2me.nanoporetech.com/wfindex/) √© uma cole√ß√£o de pipelines fornecidos pela pr√≥pria ONT;

-   Nextflow;

-   √ötil para quem quer ou n√£o programar;
:::

::: {.column width="50%"}
[![](https://epi2me.nanoporetech.com/static/dbb47454a74ffdac6ab079de768cc8af/3421a/logo-dark.webp){fig-align="center" width="450"}](https://epi2me.nanoporetech.com/wfindex/)
:::
:::

## Futuro da tecnologia

[![Lu, C., Bonini, A., Viel, J.H. et al. Toward single-molecule protein sequencing using nanopores. Nat Biotechnol 43, 312--322 (2025). https://doi.org/10.1038/s41587-025-02587-y](protein.png){fig-align="center"}](https://www.nature.com/articles/s41587-025-02587-y#citeas)

## Futuro da tecnologia

[![https://comics.dcv.fct.unl.pt/resources/](multiomics.png){fig-align="center"}](https://comics.dcv.fct.unl.pt/resources/)

## Desafios (e frustra√ß√µes)..

::: {style="text-align: center;"}
<iframe src="https://giphy.com/embed/2zdVnqmhSfAvyQhzHj" width="480" height="480" style frameBorder="0" class="giphy-embed" allowFullScreen>

</iframe>

<p><a href="https://giphy.com/gifs/showtime-season-4-episode-2zdVnqmhSfAvyQhzHj">via GIPHY</a></p>
:::

## Desafios (e frustra√ß√µes)..

::: columns
::: {.column width="50%"}
[![Ryan Wick](https://avatars.githubusercontent.com/u/7053555?v=4){width="418"}](https://github.com/rrwick)
:::

::: {.column width="50%"}
::: {style="font-size: 90%"}
***"May 2025 update***

*I've recently heard that ONT is deprecating duplex basecalling -- not surprising given their recent silence on the topic. This is now the third time (after 2D and 1D^2^) that ONT has tried and dropped both-strand basecalling! So it seems that mixed simplex-duplex read sets like the ones in this post will end up a historical curiosity rather than a standard part of ONT sequencing."* \[[link](https://rrwick.github.io/2024/05/08/duplex_assemblies.html)\]
:::
:::
:::

## Vis√£o sobre a tecnologia

## Vis√£o sobre a tecnologia {background-image="genildo.png" background-opacity=".25"}

. . .

::: columns
::: {.column width="50%"}
::: {style="color: black; font-size: 140%; font-weight: bold; text-shadow: 2px 2px 4px black;"}
<br>

-   Altera√ß√µes constantes;

-   Precisa sempre adaptar;

-   Muitas op√ß√µes de pipeline;

-   Diagn√≥stico üëé;
:::
:::

::: {.column width="50%"}
::: {style="color: black; font-size: 140%; font-weight: bold; text-shadow: 2px 2px 4px black;"}
<br>

-   Melhorias constantes;

-   Somos pesquisadores;

-   Comunidade e suporte;

-   Pesquisa üëç;
:::
:::
:::

# Dados para essa disciplina

## Amostras

-   As amostras deste disciplinas s√£o referentes ao projeto 1000 genomas [@gustafson2024]. \[[link](https://s3.amazonaws.com/1000g-ont/index.html?prefix=ALIGNMENT_AND_ASSEMBLY_DATA/100_PLUS/IN-HOUSE_MINIMAP2/)\]

-   Os c√≥digos das amostras s√£o:

    -   [HG00109](https://catalog.coriell.org/0/Sections/Search/Sample_Detail.aspx?Ref=HG00109);

    -   [HG00463](https://catalog.coriell.org/0/Sections/Search/Sample_Detail.aspx?Ref=HG00463&Product=DNA);

    -   [HG00663](https://catalog.coriell.org/0/Sections/Search/Sample_Detail.aspx?Ref=HG00663&Product=CC);

    -   [HG01063](https://catalog.coriell.org/0/Sections/Search/Sample_Detail.aspx?Ref=HG01063&PgId=166);

    -   [HG01303](https://catalog.coriell.org/0/Sections/Search/Sample_Detail.aspx?Ref=HG01303&Product=CC);

    -   [HG01524](https://catalog.coriell.org/0/Sections/Search/Sample_Detail.aspx?Ref=HG01524);

## Genes

```{r}
#| echo: false

library(gt)

readr::read_tsv(file = here::here("nanopore/genes_disciplina.bed"),
                col_names = c("chr","start","end","gene","strand")) |>
  dplyr::mutate(strand = ifelse(strand == 1,yes = "+", no = "-")) |>
  dplyr::arrange(chr, start) |>
  gt() |>
  tab_options(
    table.font.size = px(30),
    data_row.padding = px(12),
    table.width = pct(80)
  ) |>
  cols_align(
    align = "center",
    columns = everything()  # substitua pelos nomes reais das colunas
  )
```

## Programas

::: columns
::: {.column width="50%"}
-   Linux;

<br>

-   Usu√°rios windows podem usar WSL;

<br>

-   Script para instala√ß√£o;
:::

::: {.column width="50%"}
[![Conda](https://raw.githubusercontent.com/devicons/devicon/54cfe13ac10eaa1ef817a343ab0a9437eb3c2e08/icons/anaconda/anaconda-original-wordmark.svg){fig-align="center" width="350"}](https://anaconda.org/anaconda/conda)
:::
:::

## O que √© Conda?

::: {style="text-align: center;"}
<iframe src="https://giphy.com/embed/WdC26ECYnvTX4Mp2fI" width="480" height="480" style frameBorder="0" class="giphy-embed" allowFullScreen>

</iframe>

<p><a href="https://giphy.com/gifs/primevideo-lularich-WdC26ECYnvTX4Mp2fI">via GIPHY</a></p>
:::

## Conda

-   Gerenciador de pacotes/programas;

<br>

-   Cria ambiente reprodut√≠veis;

# Chamada de base (basecalling)

## Chamada de base

-   Procedimento no qual o sinal el√©trico (`.pod5`) √© convertido em bases (`.fastq` \| `.bam`);

-   Momento crucial onde se define o perfil da an√°lise que ser√° realizada;

-   Erros aqui prejudicam todas as demais an√°lises;

-   `Dorado`;

## Qual modelo usar?

```{bash eval=FALSE, echo=TRUE}
{analyte}_{pore}_{chemistry}_{speed}@version
```

-   `analyte`: DNA ou RNA?

-   `pore`: Qual t√©cnologia de poro? (`R10.4.1`/`R9.4.1`)

-   `chemistry`: Qual kit foi utilizado foi utilizado?

-   `speed`: Velocidade de leitura durante o sequenciamento (DNA 400bps)

-   `version`: Vers√£o do modelo

## Comando `dorado`

```{bash eval=FALSE, echo = TRUE}
> dorado --help
Usage: dorado [options] subcommand

Positional arguments:
aligner
basecaller
correct
demux
download
duplex
summary
trim

Optional arguments:
-h --help               shows help message and exits
-v --version            prints version information and exits
-vv                     prints verbose version information and exits
```

## Modelos `dorado`

```{bash eval=FALSE, echo = TRUE}
# Ver os modelos dispon√≠veis
dorado download --list

# Baixar o desejado na pasta desejada
dorado download --model {modelo} --models-directory {PATH}
```

## Modelos `dorado`

-   `FAST`: Mais r√°pido e com menor acur√°cia;

-   `HAC`: Alta acur√°cia;

-   `SUP`: Super acur√°cia (maior requisito computacional);

::: callout-tip
## Para escolher seu modelo.

Modelo `SUP` √© uma vantagem em situa√ß√µes de constru√ß√£o de genomas de refer√™ncia;

Para demais situa√ß√µes o `HAC` j√° √© suficiente;
:::

## `dorado` `basecaller`

```{bash eval=FALSE, echo = TRUE}
# chamada HAC sem modifica√ß√µes
dorado basecaller hac {/path/to/reads.pod5} > calls.bam

#chamada HAC com modifica√ß√µes 6mA e 5mC e 5hmC em CpG
dorado basecaller hac,6mA,5mCG_5hmCG {/path/to/reads.pod5} > calls.bam
```

## `dorado` `basecaller`

-   O padr√£o √© salvar como `BAM`;

    -   Isso vai permitir salvar as modifica√ß√µes de base;

-   A performance ideal requer GPU;

    -   Usar a tag `--device "cuda:all"`;

-   Para gerar `fastq` usar `‚Äìemit-fastq`;

-   Para novos modelos √© necess√°rio utilizar `‚Äìemit-moves`;

-   √â poss√≠vel chamar e alinhar ao genoma de refer√™ncia usando `--reference`;

## `dorado` `basecaller`

::: callout-note
## Tempo de processamento

\~ 12 horas de chamada de base + alinhamento utilizando GPU RTX 4060;

`{model}` precisa ser o caminho completo;

```{bash eval=FALSE, echo=TRUE}
dorado basecaller --recursive --trim "all" --modified-bases 5mCG_5hmCG 6mA --reference {fasta} {modelo} pod5/ --device "cuda:all" > calls.bam
```
:::

## Controle de qualidade (QC)

## Controle de qualidade (QC)

-   Garantir que as leituras estejam adequadas para prosseguir as an√°lises;

-   `fastq`;

-   Similar a ideia para dados Illumina;

## FASTQ

[![Arquivo FASTQ.](https://biocorecrg.github.io/RNAseq_course_2019/images/fastq_format.png)](https://biocorecrg.github.io/RNAseq_course_2019/fastq.html)

## Phred score

[![Phred score.](https://www.drive5.com/usearch/manual/qscores.gif){fig-align="center" width="900"}](https://www.drive5.com/usearch/manual/quality_score.html)

## Phred score

$$
Q = -10\log_{10}{P}
$$

<br>

$$
P=10^{\frac{-Q}{10}}
$$

## Phred score

$$
P=10^{\frac{-Q}{10}}
$$

| Q score | Probabilidade de chamada de base incorreta | Acur√°cia da chamada de base |
|---------------|-----------------------------------|----------------------|
| 10      | 1 em 10                                    | 90%                         |
| 20      | 1 em 100                                   | 99%                         |
| 30      | 1 em 1000                                  | 99,9%                       |
| 40      | 1 em 10000                                 | 99,99%                      |

## QC

-   `FASTQC` tambem funciona;

-   `NanoPack2` √© a atual melhor op√ß√£o;

    -   `NanoPlot` para visualiza√ß√£o das estat√≠sticas;

    -   `Chopper` para trimagem;

## NanoPlot

-   Qualidade (`Q`);

-   Tamanho (`L`);

-   N50;

[![](https://hoytpr.github.io/bioinformatics-semester/fig/N50.png){fig-align="center" width="615"}](https://hoytpr.github.io/bioinformatics-semester/materials/genomics-assembly-reporting/)

## NanoPlot

```{bash eval=FALSE, echo=TRUE}
NanoPlot -t {threads} {--fastq/--bam} {files} -o {OUTPUT_DIR_NAME}
```

## Chopper

```{bash eval=FALSE, echo=TRUE}
chopper -q 20 -l 1000 reads.fastq > trimmed_reads.fastq 
```

# Mapeamento de sequ√™ncias

## Mapeamento/alinhamento

-   Ao final da chamada de bases teremos um `.fastq` ou `.bam`[^1];

[^1]: Vamos ver o que √© um arquivo bam em breve;

<br>

-   Esses arquivos cont√©m apenas as sequ√™ncias detectadas. N√£o cont√©m informa√ß√µes das coordenadas gen√¥micas;

<br>

-   Para prosseguirmos com as an√°lises √© necess√°rio alinhar alguma refer√™ncia conhecida;

## Genoma de refer√™ncia

-   Uma sequ√™ncia de DNA consensual e representativa de uma esp√©cie;

-   N√£o √© o genoma de uma √∫nica pessoa, mas sim um "modelo" ou "padr√£o";

-   <https://www.ncbi.nlm.nih.gov/datasets/genome/>

## Genoma de refer√™ncia

. . .

::: {style="text-align: center;"}
<iframe src="https://giphy.com/embed/mMl1DphmngffO" width="343" height="480" style frameBorder="0" class="giphy-embed" allowFullScreen>

</iframe>

<p><a href="https://giphy.com/gifs/bear-polar-mMl1DphmngffO">via GIPHY</a></p>
:::

## Ursus maritimus

[![Genoma do Urso polar](images/ursopolar1.png){fig-align="center"}](https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_017311325.1/)

## Arquivos de genoma de refer√™ncia

-   `.fasta`: Sequ√™ncia de DNA por cromossomo;

-   `genomic.gff`: Coordenadas genomicas de mrna, exons, intros, ...;

-   `rna.fna`[^2]: Sequ√™ncias dos transcritos;

-   `protein.fna`: Sequ√™ncias das prote√≠nas;

[^2]: .fna e .fa s√£o outras vers√µes de fasta.

## Criar √≠ndices (`index`)

-   Arquivos de index s√£o fundamentais para auxiliar o programas nas an√°lises;

-   Eles evitam erros e computa√ß√µes demasiadas;

. . .

[![](https://www.book-editing.com/wp-content/uploads/2019/03/back-of-book-index-1080x675.jpg){fig-alt="Indicie de um livro" fig-align="center" width="700"}](https://www.book-editing.com/why-book-indexing/)

## Indexando genoma

```{bash eval=FALSE,echo=TRUE}
# usando BWA

bwa index {genoma}.fa

# usando minimap2

minimap2 -d {ref}.mmi {genoma}.fa
```

-   Use `bwa` quando for trabalhar com dados de Illumina tamb√©m;

## bwa index

-   Opera√ß√£o demorada;

-   Gera diversos arquivos: `.amb`, `.ann`, `.bwt`, `.pac` e `.sa`;

-   Na pr√°tica quase triplica o espa√ßo do genoma em nosso computador;

## Alinhando dados de nanopore

-   Padr√£o √© o `minimap2`;

-   O `dorado aligner` utiliza o `minimap2` no seu interior;

    -   `dorado aligner` consegue utilizar `bam` como input;

## Comando `minimap2`

```{bash eval=FALSE, echo=TRUE}
minimap2 -ax map-ont -Y -t {THREADS} -R {RG} {REF} {fastq} -o {sam}
```

-   `THREADS` = N√∫mero de threads;

-   `RG` = Tag de registro da amostra;

-   `REF` = Genoma de refer√™ncia indexado.

-   `fastq` = Arquivo das sequencias;

-   `sam` = Arquivo do alinhamento no formato SAM;

## Arquivo SAM

-   Arquivo padr√£o;

-   Leg√≠vel por humanos;

-   Cabe√ßalho (`@`) + tabela de alinhamento;

-   Documenta√ß√£o [online](https://samtools.github.io/hts-specs/SAMv1.pdf);

-   `BAM`[^3] e `CRAM` s√£o vers√µes bin√°rias mais leves;

[^3]: `BAM` √© o formato para a maioria das aplica√ß√µes;

## Arquivo SAM

. . .

## samtools

-   Principal programa para manipula√ß√£o desses arquivos;

<br>

-   \> 63 mil cita√ß√µes!!!

<br>

-   Roda no fundo de milhares de aplica√ß√µes;

## Fluxograma

```{bash eval=FALSE, echo=TRUE}
# Ordenar o arquivo e j√° converte para BAM
samtools sort {amostra.sam} > {amostra.bam}
# Ou
# samtools sort -o {amostra.bam} {amostra.sam} 

# Cria o index para o BAM
samtools index {amostra.bam}
```

## IGV

-   Navegador de genomas;

<br>

-   Permite visualiza√ß√µes de arquivos `BAM`, `VCF`, `BED`, dentre outros;

<br>

-   Embora exista a vers√£o online, recomendo a vers√£o local;

## Opera√ß√µes de interesse no samtools

```{bash eval=FALSE, echo=TRUE}
# Recortar regi√£o/converter
samtools view [options] {amostra_in.bam} > {amostra_out.bam}

# Exportar fastq
samtools fastq {amostra.bam} > {amostra.fastq}

# Gerar cobertura por base
samtools depth {amostra.bam} > {amostra.txt}

# Cobertura dos genes usando BED
samtools bedcov {genes.bed} {amostra.bam} > {amostra.bed}

# Cobertura m√©dia de uma regi√£o "chr:start-end". Pode ser uma amostra ou v√°rias.
samtools coverage -b {amostra.bam} -r "chr:start-end" > regiao.txt
```

# Chamada de variantes

## Variantes

[![Variantes.](https://www.genome.gov/sites/default/files/inline-images/Genomic%20variation_INDELS%20DEL%20SNV%20TANDEM.png){fig-align="center" width="1000"}](https://www.genome.gov/about-genomics/educational-resources/fact-sheets/human-genomic-variation)

## Diferentes softwares

-   GATK;

-   DeepVariant;

-   Freebayes;

-   clair3;

-   samtools + Picard;

-   Entre outros...

## `freebayes`

-   Modelagem bayesiana;

-   Monta pequenos hapl√≥tipos;

-   Criado para short-reads;

-   Propenso a erros do tipo 1 (Falsos positivos);

-   Pode ser usado para uma ou v√°rias amostras;

## Comando `freebayes`

```{bash eval=FALSE, echo=TRUE}
# Uma amostra
freebayes -f {REF} -t {REGIONS.BED} {amostra.bam} > var.vcf

# Multisample focando em uma regi√£o
ls *.bam > BAM_LIST.txt
freebayes -f {REF} -L {BAM_LIST.txt} -t {REGIONS.BED} > var.vcf
```

## Arquivo VCF

-   Arquivo padr√£o;

-   Leg√≠vel por humanos;

-   Cabe√ßalho (`#`) + tabela de alinhamento;

-   Documenta√ß√£o [online](https://samtools.github.io/hts-specs/VCFv4.2.pdf);

-   Varia√ß√µes: `.vcf`, `.vcf.gz`, `.bcf`;

## Arquivo VCF

. . .

## Filtrando arquivos VCF

```{bash eval=FALSE, echo=TRUE}
# remove variantes de qualidade menor que 1
bcftools view --exclude 'QUAL<1' variantes.vcf > variantes_filtradas.vcf

# quebra os alelos alternativos em v√°rias linhas
bcftools view --trim-alt-alleles variantes_filtradas.vcf > variantes_filtradas_trim.vcf

# remove variantes que n√£o tenham nenhum alelo alternativo nas amostras
bcftools view --min-ac 1 variantes_filtradas_trim.vcf > variantes_filtradas_trim_minac.vcf

# normaliza o vcf com base no genoma de refer√™ncia
bcftools norm -f hg38.fa variantes_filtradas_trim_minac.vcf > variantes_filtradas_trim_minac_norm.vcf
```

## `clair3`

-   Desenhada para dados de diferentes plataformas;

    -   ONT, PacBio, Illumina;

-   Usa deep learning;

-   Modos `pileup` e `full aligment` (`merge` combina√ß√£o);

-   Roda uma amostra por vez;

    -   `--gvcf`;

## Comando `clair3`

-   Usando `bioconda`:

```{bash eval=FALSE, echo=TRUE}
MODEL_NAME="[YOUR_MODEL_NAME]"         # e.g. r1041_e82_400bps_sup_v500
THREADS=4
OUTPUT_DIR="ondesalvar"
run_clair3.sh \
  --bam_fn=input.bam \                 ## change your bam file name here
  --ref_fn=ref.fa \                    ## change your reference file name here
  --threads=${THREADS} \               ## maximum threads to be used
  --platform="ont" \                   ## options: {ont,hifi,ilmn}
  --model_path="${CONDA_PREFIX}/bin/models/${MODEL_NAME}" \ 
  --output=${OUTPUT_DIR} \              ## output path prefix 
  --sample_name="nomedaamostra" \
  --gvcf \
  --bed_fn= "genes_disciplina.bed"
```

## Multi amostras

-   `GLnexus`;

-   Modelo para usar \[[link](http://www.bio8.cs.hku.hk/clair3_trio/config/clair3.yml)\];

```{bash eval=FALSE, echo=TRUE}
# rodar o glnexus para juntar as amostras
glnexus_cli --config {clair3.yml} --threads 12 [1.gvcf, 2.gvcf, 3.gvcf...] > all_samples.bcf

# transformar em vcf
bcftools view -Ov -o all_samples.vcf all_samples.bcf
```

## Anota√ß√µes

-   Na pasta do drive Genoma/ temos o arquivo `ncbi_dbsnp_disc.vcf` que cont√©m todas as variantes do dbSNP para nossa regi√£o;

```{bash eval=FALSE, echo=TRUE}
# compactar utilizando bgzip
bgzip -c "ncbi_dbsnp_disc.vcf" > "ncbi_dbsnp_disc.vcf.gz"

# Indexar o vcf
tabix -p vcf "ncbi_dbsnp_disc.vcf.gz"

# anotar o nosso vcf
bcftools annotate --threads 10 -a ncbi_dbsnp_disc.vcf.gz -c CHROM,POS,REF,ALT,-,ID -o annotado.vcf.gz nosso.vcf.gz
```

## Consultando variantes

```{bash eval=FALSE, echo=TRUE}
# Informa√ß√µes das variantes
bcftools query -f "%CHROM\t%POS\t%ID\t%REF\t%ALT[\t%GT]" {nosso.vcf}

# Gen√≥tipos como bases
bcftools query -f "%CHROM\t%POS\t%ID\t%REF\t%ALT[\t%TGT]" {nosso.vcf}

# Lista de amostas
bcftools query -s {nosso.vcf}
```

# Variantes estruturais

## Variantes estruturais (SV)

[![Variantes estruturais.](https://www.genome.gov/sites/default/files/inline-images/Genomic%20variation_Structral%20variants.png){fig-align="center" width="1000"}](https://www.genome.gov/about-genomics/educational-resources/fact-sheets/human-genomic-variation)

## Variantes estruturais (SV)

-   Altera√ß√µes gen√¥micas ‚â•50 bp: dele√ß√µes, inser√ß√µes, duplica√ß√µes, invers√µes, transloca√ß√µes;

<!-- -->

-   Representam \~1% do genoma humano, mas t√™m grande impacto funcional;

<!-- -->

-   Podem afetar genes inteiros, elementos regulat√≥rios e arquitetura cromoss√¥mica;

<!-- -->

-   Respons√°veis por \~17% das varia√ß√µes gen√©ticas entre indiv√≠duos;

## Desafios com short reads

-   Reads curtos n√£o conseguem "span" breakpoints de SVs grandes;

<!-- -->

-   Dificuldade em regi√µes repetitivas e de baixa complexidade;

<!-- -->

-   Subestima√ß√£o de SVs: detecta apenas \~60-70% das SVs reais;

<!-- -->

-   Problemas com invers√µes e transloca√ß√µes balanceadas;

<!-- -->

-   Resolu√ß√£o limitada do tamanho exato das variantes;

## Vantagens dos ONT long reads

-   Reads longos (1-100+ kb) conseguem atravessar SVs complexas;

-   Detec√ß√£o direta de breakpoints e sequ√™ncias de inser√ß√£o;

<!-- -->

-   Melhor caracteriza√ß√£o de elementos repetitivos (Alu, LINE, STRs);

<!-- -->

-   Capacidade de resolver SVs aninhadas e complexas;

<!-- -->

-   Determina√ß√£o "precisa" do tamanho e conte√∫do das variantes;

## Programas

-   Sniffles2;

<br>

-   SVIM;

<br>

-   [cuteSV](https://github.com/tjiangHIT/cuteSV);

## Sniffles2

-   Permite an√°lise de TRIOS (Pais e filhos), popula√ß√µes (multiplas amostras) e mosaico;

```{bash eval=FALSE, echo=TRUE}
# Padr√£o
sniffles --input {amostra.bam} --snf {amostra.snf} --vcf {amostra.vcf}

#Multisample
sniffles --input {amostra1.snf} {amostra2.snf} ... --vcf {todasamostra.vcf}
```

# Short tandem repeats

## O que s√£o STRs?

-   Sequ√™ncias repetitivas de 1-6 nucleot√≠deos em tandem (ex: (CAG)n, (GGCCCC)n);

<!-- -->

-   \~3% do genoma humano, altamente polim√≥rficos na popula√ß√£o;

<!-- -->

-   Unidade repetitiva: motif b√°sico que se repete;

<!-- -->

-   Expans√µes patog√™nicas: aumento anormal do n√∫mero de repeti√ß√µes;

## Identifica√ß√£o

[![](https://old-ib.bioninja.com.au/_Media/str_med.jpeg){fig-align="center"}](https://old-ib.bioninja.com.au/standard-level/topic-3-genetics/35-genetic-modification-and/dna-profiling.html)

## CODIS

[![Sistema de FBI.](https://genetek-biopharma.com/wp-content/uploads/2023/05/picture1.png){fig-align="center"}](https://genetek-biopharma.com/human-identification-kits/)

## Limita√ß√µes cr√≠ticas dos short reads

-   **Impossibilidade de sequenciar STRs grandes**: reads de 150bp n√£o conseguem cobrir expans√µes de milhares de pb;

<!-- -->

-   **PCR bias**: amplifica√ß√£o preferencial de alelos menores;

<!-- -->

-   **Stuttering**: artefatos de deslizamento durante PCR;

<!-- -->

-   **Cobertura desigual**: regi√µes GC-ricas t√™m baixa cobertura;

## Vantagens transformadoras dos ONT long reads

-   **Sequenciamento direto**: reads de 10-100+ kb cobrem completamente as expans√µes;

<!-- -->

-   **Sem PCR**: biblioteca livre de amplifica√ß√£o elimina vieses;

<!-- -->

-   **Detec√ß√£o precisa do tamanho**: contagem exata de repeti√ß√µes;

<!-- -->

-   **Resolu√ß√£o de mosaicismo**: diferentes popula√ß√µes de alelos;

<!-- -->

-   **Caracteriza√ß√£o de interrup√ß√µes**: sequ√™ncias que quebram a repeti√ß√£o perfeita;

## straglr

-   Ferramenta recomendada nos scripts da ONT;

-   Eu acho "estranha";

```{bash eval=FALSE, echo=TRUE}
python3 straglr.py {amostra.bam} {ref.fasta} {output_prefix} --loci {regiao.bed}
```

# Determina√ß√£o de hapl√≥tipos

## O que s√£o hapl√≥tipos?

-   Combina√ß√£o de variantes gen√©ticas (SNPs, indels) em um mesmo cromossomo;
-   Heran√ßa em bloco: variantes ligadas fisicamente s√£o transmitidas juntas;
-   Import√¢ncia cl√≠nica: associa√ß√µes com doen√ßas, farmacogen√¥mica, estudos populacionais;

## Por que determinar hapl√≥tipos?

-   Compreender heran√ßa de variantes patog√™nicas;
-   An√°lise de desequil√≠brio de liga√ß√£o;
-   Estudos de associa√ß√£o gen√¥mica (GWAS);
-   Medicina personalizada;

## Desafios com short reads (Illumina)

-   Reads curtos (\~150-300 bp) n√£o conseguem conectar variantes distantes;
-   Necessidade de infer√™ncia estat√≠stica (haplotype phasing);
-   Limita√ß√µes em regi√µes repetitivas e estruturalmente complexas;
-   Erros de fase em variantes heterozig√≥ticas;

## Vantagens dos ONT long reads:

-   Reads longos (1-100+ kb) capturam m√∫ltiplas variantes em uma √∫nica mol√©cula;
-   Determina√ß√£o direta de fase (direct phasing);
-   Melhor resolu√ß√£o de variantes estruturais;
-   Cobertura de regi√µes complexas do genoma;

## Faseamento

[![Vantagens no faseamento](https://wp.unil.ch/gtf/files/2020/05/EtNR1T.png){fig-align="center"}](https://wp.unil.ch/gtf/applications/)

## Programas

-   [WhatsHap](https://whatshap.readthedocs.io/en/latest/);

<br>

-   [Longphase](https://github.com/twolinin/longphase);

<br>

-   [HapCUT2](https://github.com/vibansal/HapCUT2);

## Fluxo de trabalho

```{mermaid}
flowchart LR
   f1[bam]
   f2[vcf]
   f3(genome)

   f1 & f2 & f3 --> p1{phase}
   p1 --> f4[phased.vcf]
   f4 & f1 --> p2{haplotag}
   p2 --> f5[phased.bam]
```

## WhatsHap

-   Permite trabalhar com \>1 amostra no vcf;

-   N√£o lida com variantes multialelicas;

-   N√£o lida com SVs;

```{bash eval=FALSE, echo=TRUE}
# Phase
whatshap phase --indels -o phased.vcf --reference=reference.fasta input.vcf input.bam

#Haplotag
whatshap haplotag -o haplotagged.bam --reference reference.fasta phased.vcf.gz alignments.bam
```

## Longphase

-   Permite apenas 1 amostra por vcf;

-   Suporta com SVs;

-   √â capaz de utilizar a metila√ß√£o para a fase;

```{bash eval=FALSE, echo=TRUE}
# Phase. --sv-file passa o vcf de SVs
longphase phase -s SNP.vcf -b alignment.bam -r reference.fasta -t 8  -o phased_prefix --indels --ont

# Haplotag 
longphase haplotag -r reference.fasta -s phased_snp.vcf --sv-file phased_sv.vcf -b alignment.bam -t 8 -o tagged_bam_prefix
```

# Montagem de genomas

## **O que √© montagem de genoma?**

-   Processo de reconstitui√ß√£o da sequ√™ncia completa do DNA a partir de reads fragmentados;

-   Objetivo: obter sequ√™ncia cont√≠nua (contigs/scaffolds) representando cromossomos inteiros;

-   Desafio computacional: resolver regi√µes repetitivas, gaps e varia√ß√µes estruturais;

-   Qualidade medida por: contiguidade (N50), completude (BUSCO), acur√°cia (QV);

## Por que montar genomas?

-   **Genomas de refer√™ncia**: esp√©cies n√£o caracterizadas, variedades/linhagens espec√≠ficas;

```{=html}
<!-- -->
```
-   **Gen√¥mica comparativa**: evolu√ß√£o, diversidade, adapta√ß√µes;

```{=html}
<!-- -->
```
-   **Medicina personalizada**: genomas individuais, varia√ß√µes estruturais complexas;

```{=html}
<!-- -->
```
-   **Biotecnologia**: otimiza√ß√£o de organismos produtores, synthetic biology;

## Limita√ß√µes cr√≠ticas dos short reads

-   **Regi√µes repetitivas**: sequ√™ncias \>150bp n√£o podem ser resolvidas;

```{=html}
<!-- -->
```
-   **Gaps inevit√°veis**: centromeros, heterocromatina, rDNA clusters;

```{=html}
<!-- -->
```
-   **Montagens fragmentadas**: milhares de contigs pequenos;

```{=html}
<!-- -->
```
-   **Varia√ß√µes estruturais perdidas**: invers√µes, transloca√ß√µes complexas;

```{=html}
<!-- -->
```
-   **Necessidade de scaffolding**: dados adicionais (mate-pairs, Hi-C);

## Vantagens revolucion√°rias dos ONT long reads

-   **Spanning repeats**: reads de 10-100kb atravessam a maioria das repeti√ß√µes

```{=html}
<!-- -->
```
-   **Montagens ultra-cont√≠guas**: cromossomos completos em single contigs

```{=html}
<!-- -->
```
-   **Resolu√ß√£o de regi√µes complexas**: centromeros, telomeros, rDNA

```{=html}
<!-- -->
```
-   **Detec√ß√£o completa de SVs**: rearranjos estruturais preservados

```{=html}
<!-- -->
```
-   **Redu√ß√£o dram√°tica de gaps**: genomas nearly gap-free

```{=html}
<!-- -->
```
-   **Haplotype phasing**: separa√ß√£o de cromossomos hom√≥logos

## Programas

### Montadores de primeira gera√ß√£o (overlap-based):

-   **Canu**: robusto, alta qualidade, computacionalmente intensivo;

```{=html}
<!-- -->
```
-   **Flye**: r√°pido, eficiente em mem√≥ria, bom para genomas grandes;

```{=html}
<!-- -->
```
-   **Raven**: ultrarr√°pido, otimizado para long reads;

```{=html}
<!-- -->
```
-   **NextDenovo**: h√≠brido, combina estrat√©gias diferentes;

## Programas

### **Montadores de nova gera√ß√£o:**

-   **Shasta**: algoritmo de grafo string, extremamente r√°pido;

-   **Verkko**: h√≠brido ONT+HiFi, qualidade superior;

-   **Hifiasm**: originalmente para HiFi, adaptado para ONT;

-   **PECAT:** vers√°til, realiza corre√ß√£o e polimento;

## Programas

-   [PECAT](https://github.com/lemene/PECAT);

<br>

-   [Hifiasm](https://github.com/chhylp123/hifiasm);

## PECAT

-   Cole√ß√£o de ferramentas;

-   minimap2;

-   clair3;

-   medaka;

## PECAT

![](pecat01.png){fig-align="center"}

## PECAT

```{bash eval=FALSE, echo=TRUE}
# Ver op√ß√µes
pecat.pl

# Cria um arquivo texto com todos os parametros
pecat.pl config {cfg_name}

# Roda
pecat.pl unzip {cfg_name}
```

## Hifiasm

-   Desenhado para Hifi reads(PacBio), adaptado para ONT;

-   Gerar grafos;

-   Funciona para diploides;

-   R√°pido;

## Alinhando os ctgs ao genoma de referencia

```{bash eval=FALSE, echo=TRUE}
#Juntar todos os ctgs num unico arquivo

# minimap asm20
minimap2 -t 10 -ax asm20 -B 2 -E 3,1 -O 6,100 --cs /media/lab/Data1/genomes/1KG_ONT_VIENNA_hg38.fa OCA2_ctgs.fasta > OCA2_ctgs.sam

# Transformar em bam
samtools sort OCA2_ctgs.sam > OCA2_ctgs.bam
samtools index OCA2_ctgs.bam
```

# Modifica√ß√£o de bases

## **O que s√£o modifica√ß√µes de bases?**

-   Altera√ß√µes qu√≠micas covalentes nas bases do DNA ap√≥s s√≠ntese (modifica√ß√µes epigen√©ticas);

-   Principais tipos: 5-metilcitosina (5mC), 5-hidroximetilcitosina (5hmC), 6-metiladenina (6mA);

-   N√£o alteram sequ√™ncia de DNA, mas afetam fun√ß√£o g√™nica e estrutura cromoss√¥mica;

-   Her√°veis atrav√©s de divis√µes celulares, fundamentais para regula√ß√£o epigen√©tica;

## **Import√¢ncia biol√≥gica**

-   **Silenciamento g√™nico**: promotores hipermetilados ‚Üí genes silenciados;

-   **Imprinting gen√¥mico**: express√£o parental-espec√≠fica;

-   **Inativa√ß√£o do X**: compensa√ß√£o de dose em mam√≠feros f√™meas;

-   **Supress√£o de elementos transpon√≠veis**: defesa gen√¥mica;

-   **Diferencia√ß√£o celular**: estabelecimento de identidade celular;

## **Contextos principais:** 

-   **CpG islands**: regi√µes ricas em dinucleot√≠deos CG;

-   **Gene bodies**: metila√ß√£o intrag√™nica;

-   **Elementos repetitivos**: LINE, SINE, retrotransposons;

-   **Regi√µes regulat√≥rias**: enhancers, silencers, promotores;

## **Limita√ß√µes de m√©todos tradicionais:**

-   **Bisulfite sequencing**: tratamento qu√≠mico degradativo, perda de \~85% do DNA;

-   **Immunoprecipitation**: resolu√ß√£o limitada, vieses de anticorpos;

-   **Arrays de metila√ß√£o**: cobertura restrita a sondas pr√©-definidas;

-   **Short reads**: impossibilidade de fase hapl√≥tipica das modifica√ß√µes;

## **Vantagens revolucion√°rias da ONT**

-   **Detec√ß√£o direta**: modifica√ß√µes detectadas em DNA nativo, sem tratamento qu√≠mico;

-   **Leitura simult√¢nea**: sequ√™ncia + modifica√ß√µes na mesma mol√©cula;

-   **Long reads**: contexto epigen√©tico em escala de dezenas de kb;

-   **Phasing haplot√≠pico**: modifica√ß√µes espec√≠ficas por alelo parental;

-   **Cobertura gen√¥mica completa**: sem vieses de amplifica√ß√£o ou captura;

-   **An√°lise em tempo real**: modifica√ß√µes detectadas durante sequenciamento;

## Modbam

-   O produto de chamada de base √© chamado de modbam. Embora a extens√£o seja `.bam`;

-   S√£o adicionadas duas tags no bam contendo as informa√ß√µes de modifica√ß√£o: `MM` e `ML`;

-   `IGV`;

## Modkit

-   Kit de ferramentas desenvolvida pela Oxford Nanopore Technologies;

```{=html}
<!-- -->
```
-   Pipeline completo: desde BAM files at√© visualiza√ß√µes finais;

-   Interface command-line intuitiva e [bem documentada](https://nanoporetech.github.io/modkit/);

## Modkit

-   `pileup`: Agrega√ß√£o de probabilidades de modifica√ß√£o por posi√ß√£o gen√¥mica;

-   `DMR`: Calculo de regi√µes diferencialmente metiladas;

-   `Entropy`: medida de heterogeneidade de modifica√ß√£o em popula√ß√£o celular;

## Modkit - pileup

-   Gera um bedmethyl como resultado;

-   Pode ser para genoma completo o posi√ß√µes espec√≠ficas;

```{bash eval=FALSE, echo=TRUE}
# Pileup padr√£o
modkit pileup path/to/reads.bam output/path/pileup.bed --cpg --ref path/to/reference.fasta

# Pileup por regi√£o. Ex CpG
modkit pileup path/to/reads.bam output/path/pileup.bed \
  --cpg \
  --ref path/to/reference.fasta \
  --include-bed path/to/my_cpgs.bed
```

## Modkit - pileup por HP

-   √â poss√≠vel analisar por hapl√≥tipo:

```{bash eval=FALSE, echo=TRUE}
modkit pileup path/to/reads.bam output/directory/ --cpg --ref <reference.fasta> --partition-tag HP --prefix haplotyped

```

## Modkit - DMR

```{bash eval=FALSE, echo=TRUE}
# Gerar os pileups para as amostras individualmente

# bgzip e tabix para os beds
bgzip -k ${pileup}
tabix -p bed ${pileup}.gz

# dmr pair para pares
modkit dmr pair -a {amostra1.bed.gz} -b {amostra2.bed.gz} -o {output_dir} -r {regioes.bed} --ref {genoma.fa} --base C --threads 10
```

## Modkit - entropy

```{bash eval=FALSE, echo=TRUE}
modkit entropy --in-bam ${mod_bam} \
 -o ${output_directory} \
 --regions ${regions_bed_file} \  # BED3 or BED4 file of regions
 --cpg \  # specify CpG dinucleotides and combine strands
 --ref ${ref} \
 --threads 10
```

## Modkit - extras

-   [Localize](https://nanoporetech.github.io/modkit/intro_localize.html)

-   [Open Chromatin](https://nanoporetech.github.io/modkit/intro_open_chromatin.html)

# Refer√™ncias
